<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ÎÜçÏûëÎ¨º Î≥ëÌï¥Ï∂© Î∂ÑÌè¨ Î∞è ÏòàÏ∏° ÏßÄÎèÑ ÏãúÏä§ÌÖú - VWorld ÏßÄÎèÑ Í∏∞Î∞ò Ïã§ÏãúÍ∞Ñ Î≥ëÌï¥Ï∂© Î™®ÎãàÌÑ∞ÎßÅ">
    <title>ÎÜçÏûëÎ¨º Î≥ëÌï¥Ï∂© ÏòàÏ∏°ÏßÄÎèÑ | Crop Pest Prediction Map</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- OpenLayers -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@9.2.4/ol.css">
    <script src="https://cdn.jsdelivr.net/npm/ol@9.2.4/dist/ol.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- App CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="app">
        <!-- ===== Header ===== -->
        <header id="header">
            <div class="header-left">
                <div class="header-logo">üåæ</div>
                <div>
                    <div class="header-title">ÎÜçÏûëÎ¨º Î≥ëÌï¥Ï∂© ÏòàÏ∏°ÏßÄÎèÑ</div>
                    <div class="header-subtitle">Crop Pest & Disease Prediction Map</div>
                </div>
            </div>
            <div class="header-right">
                <div class="header-date" id="header-date"></div>
                <button class="settings-btn" id="settings-btn" onclick="settingsModal.open()" title="ÏÑ§Ï†ï">
                    <span class="material-icons">settings</span>
                </button>
            </div>
        </header>

        <!-- ===== Main Content ===== -->
        <div id="main-content">

            <!-- ===== Left Sidebar ===== -->
            <aside id="sidebar">
                <!-- ÏûëÎ¨º ÏÑ†ÌÉù -->
                <div class="sidebar-section">
                    <div class="section-title">
                        <span class="material-icons">eco</span>
                        ÏûëÎ¨º ÏÑ†ÌÉù
                    </div>
                    <div class="crop-grid" id="crop-grid"></div>
                </div>

                <!-- Î≥ëÌï¥Ï∂© Î™©Î°ù -->
                <div class="sidebar-section">
                    <div class="section-title">
                        <span class="material-icons">bug_report</span>
                        Î≥ëÌï¥Ï∂© Î™©Î°ù
                    </div>
                    <div class="pest-list" id="pest-list"></div>
                </div>

                <!-- ÌïÑÌÑ∞ -->
                <div class="sidebar-section">
                    <div class="section-title">
                        <span class="material-icons">filter_alt</span>
                        ÌïÑÌÑ∞
                    </div>

                    <div class="filter-group">
                        <div class="filter-label">Ïãú/ÎèÑ ÏÑ†ÌÉù</div>
                        <select class="filter-select" id="province-select"></select>
                    </div>

                    <div class="filter-group">
                        <div class="filter-label">ÏòàÏ∏° ÎÇ†Ïßú</div>
                        <div class="date-input-wrapper">
                            <input type="date" id="date-input">
                            <span class="material-icons">calendar_today</span>
                        </div>
                    </div>
                </div>

                <!-- NCPMS API ÏÉÅÌÉú -->
                <div class="sidebar-section">
                    <div class="section-title">
                        <span class="material-icons">cloud</span>
                        NCPMS API
                    </div>
                    <div id="ncpms-api-status" style="font-size: 12px; color: var(--text-muted); line-height: 1.6;">
                        <div class="status-indicator" style="margin-bottom: 6px;">
                            <span class="status-dot" id="api-status-dot"></span>
                            <span id="api-status-text">API Ïó∞Í≤∞ ÎåÄÍ∏∞Ï§ë</span>
                        </div>
                        <button class="ncpms-map-btn" id="ncpms-map-btn" onclick="ncpmsWidget.toggle()">
                            <span class="material-icons" style="font-size:16px;vertical-align:middle;">map</span>
                            NCPMS ÏòàÏ∏°ÏßÄÎèÑ
                        </button>
                        <div style="font-size:11px; color:var(--text-muted); margin-top:6px;">
                            <a href="https://ncpms.rda.go.kr/npms/openApiTmp.np" target="_blank"
                                style="color:var(--accent-primary);">API Key Î∞úÍ∏â ‚Üí</a>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- ===== Map ===== -->
            <div id="map-container">
                <!-- ÏßÄÎèÑ -->
                <div id="map"></div>

                <!-- Î∞∞Í≤ΩÏßÄÎèÑ Ï†ÑÌôò -->
                <div class="map-layer-toggle">
                    <button class="layer-btn active" data-layer="base">Í∏∞Î≥∏</button>
                    <button class="layer-btn" data-layer="satellite">ÏúÑÏÑ±</button>
                    <button class="layer-btn" data-layer="hybrid">ÌïòÏù¥Î∏åÎ¶¨Îìú</button>
                    <span style="width:1px;height:20px;background:var(--border-color);margin:0 2px;"></span>
                    <button class="nofly-btn" id="nofly-toggle" onclick="mapManager.toggleNoFlyZone() ? this.classList.add('active') : this.classList.remove('active')">
                        <span class="material-icons" style="font-size:14px;vertical-align:middle;margin-right:2px;">flight</span>Í∏àÏßÄÍµ¨Ïó≠
                    </button>
                </div>

                <!-- Î≤îÎ°Ä -->
                <div class="map-legend" id="map-legend"></div>

                <!-- ÌåùÏóÖ -->
                <div id="map-popup" class="map-popup" style="display:none;"></div>

                <!-- NCPMS ÏòàÏ∏°ÏßÄÎèÑ Ïò§Î≤ÑÎ†àÏù¥ -->
                <div id="ncpms-overlay" class="ncpms-overlay" style="display:none;">
                    <div class="ncpms-overlay-header">
                        <span class="material-icons" style="font-size:18px;">pest_control</span>
                        <span>NCPMS Î≥ëÌï¥Ï∂© ÏòàÏ∏°ÏßÄÎèÑ</span>
                        <div style="flex:1;"></div>
                        <select id="ncpms-crop-select" class="ncpms-crop-select">
                            <option value="">ÏûëÎ¨º ÏÑ†ÌÉù...</option>
                        </select>
                        <button class="ncpms-close-btn" onclick="ncpmsWidget.close()">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div id="ncpms-map-content" class="ncpms-map-content">
                        <div class="ncpms-placeholder" id="ncpms-placeholder">
                            <span class="material-icons" style="font-size:48px;color:var(--text-muted);">map</span>
                            <p>ÏûëÎ¨ºÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ NCPMS ÏòàÏ∏°ÏßÄÎèÑÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§.</p>
                            <p class="ncpms-php-notice" id="ncpms-php-notice" style="display:none;">
                                <span class="material-icons" style="font-size:14px;vertical-align:middle;color:var(--risk-caution);">warning</span>
                                PHPÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Web StationÏóêÏÑú PHP ÌîÑÎ°úÌïÑÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.
                            </p>
                        </div>
                        <div id="ncpms-map" style="width:100%;height:100%;"></div>
                    </div>
                </div>

                <!-- Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ -->
                <div id="loading-overlay" class="loading-overlay">
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">ÏßÄÎèÑÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
                    </div>
                </div>
            </div>

            <!-- ===== Right Info Panel ===== -->
            <aside id="info-panel">
                <!-- ÌÉ≠ -->
                <div class="panel-tabs">
                    <button class="panel-tab active" data-tab="search">
                        <span class="material-icons">search</span> Ï£ºÏÜåÍ≤ÄÏÉâ
                    </button>
                    <button class="panel-tab" data-tab="chart">
                        <span class="material-icons">show_chart</span> Í∑∏ÎûòÌîÑ
                    </button>
                    <button class="panel-tab" data-tab="desc">
                        <span class="material-icons">description</span> ÏÑ§Î™Ö
                    </button>
                </div>

                <!-- ÌÉ≠ Ïª®ÌÖêÏ∏† -->
                <div class="panel-content">
                    <!-- Ï£ºÏÜåÍ≤ÄÏÉâ ÌÉ≠ -->
                    <div class="tab-pane active" id="tab-search">
                        <div class="search-box">
                            <span class="material-icons search-icon">search</span>
                            <input type="text" class="search-input" id="search-input" placeholder="Ï£ºÏÜå ÎòêÎäî ÏßÄÏó≠Î™Ö Í≤ÄÏÉâ...">
                            <button class="search-btn" id="search-btn">Í≤ÄÏÉâ</button>
                        </div>

                        <!-- ÏßÄÏó≠ Ï†ïÎ≥¥ -->
                        <div id="region-info"></div>

                        <!-- Í≤ÄÏÉâ Í≤∞Í≥º -->
                        <div class="search-results" id="search-results"></div>
                    </div>

                    <!-- Í∑∏ÎûòÌîÑ ÌÉ≠ -->
                    <div class="tab-pane" id="tab-chart">
                        <div class="chart-title">
                            <span class="material-icons">timeline</span>
                            ÏúÑÌóòÎèÑ ÏòàÏ∏° Ï∂îÏù¥
                        </div>
                        <div class="chart-container">
                            <canvas id="prediction-chart"></canvas>
                        </div>

                        <div class="chart-title" style="margin-top:12px;">
                            <span class="material-icons">thermostat</span>
                            Í∏∞ÏÉÅ Îç∞Ïù¥ÌÑ∞
                        </div>
                        <div class="chart-container">
                            <canvas id="weather-chart"></canvas>
                        </div>

                        <div class="chart-title" style="margin-top:12px;">
                            <span class="material-icons">wb_sunny</span>
                            ÏùºÏÇ¨Îüâ / Í∞ïÏàòÎüâ
                            <span class="chart-source-tag">NASA POWER</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="solar-precip-chart"></canvas>
                        </div>
                    </div>

                    <!-- ÏÑ§Î™Ö ÌÉ≠ -->
                    <div class="tab-pane" id="tab-desc">
                        <div id="description-content">
                            <div class="empty-state">
                                <span class="material-icons">info</span>
                                <p>Î≥ëÌï¥Ï∂©ÏùÑ ÏÑ†ÌÉùÌïòÎ©¥<br>ÏÉÅÏÑ∏ ÏÑ§Î™ÖÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

        </div>

        <!-- ===== Status Bar ===== -->
        <div class="status-bar">
            <div class="status-left">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span>VWorld Ïó∞Í≤∞Îê®</span>
                </div>
                <span>|</span>
                <span id="status-coords">36.00000, 127.50000</span>
            </div>
            <div class="status-right">
                <span>OpenLayers 9.x</span>
                <span>|</span>
                <span>NCPMS API</span>
                <span>|</span>
                <span>¬© 2025</span>
            </div>
        </div>

        <!-- ===== Settings Modal ===== -->
        <div class="modal-overlay" id="settings-modal" style="display:none;">
            <div class="modal-container">
                <div class="modal-header">
                    <h2><span class="material-icons">settings</span> ÏÑ§Ï†ï</h2>
                    <button class="modal-close" onclick="settingsModal.close()"><span
                            class="material-icons">close</span></button>
                </div>
                <div class="modal-body">
                    <!-- VWorld API -->
                    <div class="settings-group">
                        <div class="settings-group-title">
                            <span class="material-icons">map</span> VWorld API
                        </div>
                        <div class="settings-field">
                            <label for="setting-vworld-key">API Key</label>
                            <div class="settings-input-wrapper">
                                <input type="text" id="setting-vworld-key" placeholder="VWorld API Key ÏûÖÎ†•...">
                                <button class="settings-eye-btn"
                                    onclick="settingsModal.toggleVisibility('setting-vworld-key')">
                                    <span class="material-icons">visibility_off</span>
                                </button>
                            </div>
                            <div class="settings-help">
                                <a href="https://www.vworld.kr/dev/v4dv_2dguide2_s001.do" target="_blank">VWorld API Key
                                    Î∞úÍ∏â ‚Üí</a>
                            </div>
                        </div>
                    </div>

                    <!-- NCPMS API -->
                    <div class="settings-group">
                        <div class="settings-group-title">
                            <span class="material-icons">cloud</span> NCPMS Î≥ëÌï¥Ï∂©ÏòàÏ∏° API
                        </div>
                        <div class="settings-field">
                            <label for="setting-ncpms-key">API Key</label>
                            <div class="settings-input-wrapper">
                                <input type="text" id="setting-ncpms-key" placeholder="NCPMS API Key ÏûÖÎ†•...">
                                <button class="settings-eye-btn"
                                    onclick="settingsModal.toggleVisibility('setting-ncpms-key')">
                                    <span class="material-icons">visibility_off</span>
                                </button>
                            </div>
                            <div class="settings-help">
                                <a href="https://ncpms.rda.go.kr/npms/openApiTmp.np" target="_blank">NCPMS API Key Î∞úÍ∏â
                                    ‚Üí</a>
                            </div>
                        </div>
                    </div>

                    <!-- API ÏÉÅÌÉú ÌëúÏãú -->
                    <div class="settings-status" id="settings-status"></div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn secondary" onclick="settingsModal.close()">Ï∑®ÏÜå</button>
                    <button class="modal-btn primary" onclick="settingsModal.save()">Ï†ÄÏû•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- App Scripts (load order matters) -->
    <script src="js/data.js"></script>
    <script src="js/ncpms-api.js"></script>
    <script src="js/map.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/panel.js"></script>
    <script src="js/legend.js"></script>
    <script src="js/ncpms-widget.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/app.js"></script>
</body>

</html>